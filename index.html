<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Práctica de Fonemas</title>
<style>
body { font-family: system-ui; background:#f9f9f9; margin:0; padding:20px; }
h1 { font-size: 28px; }
.big { font-size: 48px; font-weight: 800; text-align:center; margin: 40px 0; }
button { font-size: 18px; padding: 14px 20px; border-radius: 14px; border: none; background:#222; color:#fff; }
button.secondary { background:#666; }
.controls { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
audio { width:100%; margin-top:20px; }
.info { text-align:center; color:#666; margin-top:10px; }
</style>
</head>
<body>

<h1>Práctica de pronunciación</h1>

<div class="big" id="word">Presiona comenzar</div>

<div class="controls">
  <button id="perm">Permitir micrófono</button>
  <button id="start" disabled>Comenzar</button>
  <button id="stop" class="secondary" disabled>Detener</button>
</div>

<audio id="audio" controls></audio>
<div class="info" id="info"></div>

<script>
const palabras = [
"pa","pe","pi","po","pu",
"aba","obo","ubu","ebe","ibi",
"pasa","basa","pesa","mesa","pala","bala",
"pudo","mudo","bata","bote","buzo","bebé","bicho","billete"
];

let stream, recorder, chunks=[], i=0, activo=false;

const word=document.getElementById("word");
const info=document.getElementById("info");
const audio=document.getElementById("audio");

document.getElementById("perm").onclick = async () => {
  stream = await navigator.mediaDevices.getUserMedia({audio:true});
  document.getElementById("start").disabled=false;
  info.textContent="Micrófono listo";
};

document.getElementById("start").onclick = async () => {
  activo=true;
  document.getElementById("stop").disabled=false;
  ciclo();
};

document.getElementById("stop").onclick = ()=> activo=false;

async function ciclo(){
  while(activo){
    let p = palabras[i % palabras.length];
    word.textContent = p;
    info.textContent="Habla ahora";

    chunks=[];
    recorder = new MediaRecorder(stream);
    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.start();

    await esperar(2500);   // tiempo para hablar
    recorder.stop();

    await esperar(300);
    const blob = new Blob(chunks,{type:"audio/webm"});
    audio.src = URL.createObjectURL(blob);
    audio.play();

    info.textContent="Escuchando tu voz";
    await esperar(3500);   // tiempo para escuchar
    i++;
  }
}

function esperar(ms){ return new Promise(r=>setTimeout(r,ms)); }
</script>

</body>
</html>
